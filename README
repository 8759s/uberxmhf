<srcroot> refers to the directory where this README resides

This document briefly describes the layout of the source-code and associated build 
details for XMHF development.
For a more detailed XMHF build and debugging documentation refer to <srcroot>/docs/OVERVIEW.md
and <srcroot>/docs/README.md

Author: Amit Vasudevan (amitvasudevan@acm.org)
 

1. Development environment:
---------------------------

Ubuntu 12.04 LTS 64-bit
 

2. Ubuntu packages needed:
--------------------------

sudo apt-get install pbuilder texinfo ruby build-essential autoconf libtool pkg-config
sudo apt-get install gcc-multilib


3. Other packages and environment settings needed:
--------------------------------------------------

Clang
	Version 3.3 - available at: http://llvm.org/releases/3.3/clang+llvm-3.3-i386-debian6.tar.bz2
    Untar and setup PATH to point to clang "bin" directory; XMHF uses Clang as the C compiler.

Add <srcroot>/tools/arch/<target triad> to the PATH so the build harness can find required supporting scripts
for the target architecture (see Section 5 below)

4. XMHF source organization:
----------------------------

<srcroot>/ 									-- build harness and scripts

<srcroot>/tools 							-- various scripts used during the build process

<srcroot>/include							-- top-level XMHF headers
<srcroot>/include/arch						-- arch. specific headers

<srcroot>/xmhf-bootloader					-- XMHF bootloader

<srcroot>/xmhf-libs							-- various "mini" libraries

<srcroot>/xmhf-libs/libxmhfhw				-- XMHF hardware backend library
<srcroot>/xmhf-libs/libxmhfc				-- mini C runtime library (memcpy, strcpy etc.)
<srcroot>/xmhf-libs/libxmhfcrypto 			-- small crypto library (SHA-1, AES etc.)
<srcroot>/xmhf-libs/libxmhfutil 			-- various general purpose utilities (e.g., command line parsing)
<srcroot>/xmhf-libs/libtv_utpm  			-- micro software TPM library (still a work in progress)

<srcroot>/xmhf-slabs/						-- houses XMHF framework modules

<srcroot>/xmhf-slabs/shared					-- shared modules that are part of every other XMHF module

<srcroot>/xmhf-slabs/hypapps				-- individual hypapp modules
<srcroot>/xmhf-slabs/hypapps/xhhyperdep		-- hyper Data Execution Prevention (DEP) hypapp

<srcroot>/xmhf-slabs/xmhf-core				-- XMHF core modules
<srcroot>/xmhf-slabs/xmhf-core/include		-- XMHF core specific headers
<srcroot>/xmhf-slabs/xmhf-core/xcprimeon	-- core initialization module
<srcroot>/xmhf-slabs/xmhf-core/xcsmp		-- core SMP support module
<srcroot>/xmhf-slabs/xmhf-core/xcexhub		-- core exception handling module
<srcroot>/xmhf-slabs/xmhf-core/xcrichguest	-- core rich-guest support module
<srcroot>/xmhf-slabs/xmhf-core/xcihub		-- core intercept handling module
<srcroot>/xmhf-slabs/xmhf-core/xcapi		-- core API module


5. Building:
------------

The following demonstrates building the XMHF core and hyperdep hypapp

	a) Building XMHF core: done while in <srcroot>

		./autogen.sh
		./configure --with-target-cpu=x86 --with-target-container=vmx --with-target-platform=x86pc --with-xmhf-hypapps=xmhf-slabs/hypapps/xhhyperdep
		make

	If all went well <srcroot>/_objects/xmhf-<target triad>.bin.gz will be created
	
	<target triad> is the XMHF target arch. E.g., xmhf-x86-vmx-x86pc.bin.gz


 
6. Installing and running the binaries:
---------------------------------------

Refer to <srcroot>/docs/hardware-requirements.md for XMHF target hardware requirements.

Refer to <srcroot>/docs/installing-xmhf.md for the base installation. Replace the section 
"GRUB entry to boot Linux" with the contents below:

title  XMHF - Ubuntu 12.04 LTS
    rootnoverify (hd0,0)                        
    kernel /xmhf-x86-vmx-x86pc.bin.gz serial=115200,8n1,0x3f8
    modulenounzip (hd0,0)+1                       
    modulenounzip (hd0,0)+1                       
    modulenounzip /4th_gen_i5_i7_SINIT_75.BIN
    
