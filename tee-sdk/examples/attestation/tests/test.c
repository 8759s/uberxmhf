/*
 * @XMHF_LICENSE_HEADER_START@
 *
 * eXtensible, Modular Hypervisor Framework (XMHF)
 * Copyright (c) 2009-2012 Carnegie Mellon University
 * Copyright (c) 2010-2012 VDG Inc.
 * All Rights Reserved.
 *
 * Developed by: XMHF Team
 *               Carnegie Mellon University / CyLab
 *               VDG Inc.
 *               http://xmhf.org
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *
 * Redistributions in binary form must reproduce the above copyright
 * notice, this list of conditions and the following disclaimer in
 * the documentation and/or other materials provided with the
 * distribution.
 *
 * Neither the names of Carnegie Mellon or VDG Inc, nor the names of
 * its contributors may be used to endorse or promote products derived
 * from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND
 * CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
 * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS
 * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
 * TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF
 * THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * @XMHF_LICENSE_HEADER_END@
 */

#include "unity.h"
#include <assert.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <stdbool.h>

#include <openssl/err.h>
#include <openssl/evp.h>
#include <openssl/bio.h>
#include <openssl/buffer.h>
#include <openssl/rsa.h>
#include <openssl/sha.h>
#include <openssl/engine.h>

#include <json/json.h>

#include "../common.h"

/* Some known-good values to exercize functionality */
unsigned char tpm_pcr_composite[47] = "\x01\x00\x03\x00\x00\x00\x28\x37\xfc\xa5\xde\xd1\x2d\x10\x23\xc4\x39\x89\xd0\x19\x6d\x8b\x61\x93\x4c\xdf\x74\x31\xa2\xdc\x4c\x22\xf9\xc5\x44\x4a\x41\x62\x5d\x05\xf9\x58\x98\xe0\x55\xf7\x50";
unsigned char sig[256] = "\x23\x6f\xca\xdc\x3d\x8f\x59\x03\xa1\xc4\xb5\x63\xca\xd0\xda\x3e\x07\x8f\x67\x2a\x30\xef\xfd\x37\x8c\x94\x96\x6a\x12\x50\x8c\x89\xfe\xe5\xe8\xb0\x95\x7d\xc0\xd5\x51\x5e\xe5\x86\xcb\x59\xb7\xdf\x7c\xb8\xbc\x74\xc7\xe8\x27\x63\x38\xd1\x3d\x93\x9a\x65\xae\x8b\xd3\x04\x3f\xd7\xa2\x30\x5b\x21\xf0\x95\xa0\x34\x95\x1b\x76\xdc\x40\xe5\xc3\x3b\xde\xa5\x96\xdf\x5b\xf1\x29\x49\xbc\x2c\x15\x86\x5b\x33\x29\x5c\xee\x40\xa3\x9e\x7a\x4c\x46\x87\xed\x99\xdc\x1d\x37\xf7\x82\xd5\x3e\x69\x49\x63\x00\xfc\x24\x83\x10\x4d\xb7\x0a\x9a\xda\x7d\xdd\xd6\x0c\xfd\x81\x68\xdb\x27\xdc\x14\x67\xc3\x1c\xab\x19\x93\x02\x2a\xc7\x37\x22\x9a\x7f\x69\x51\x40\x2e\x7a\x51\x87\xd6\x71\xa8\x05\x91\x49\x79\x65\x1f\x63\x4b\xf2\xc8\x52\x7c\x9b\x61\x13\x33\x54\x6a\xae\xbf\x5d\x2b\x8f\x0c\x51\xfe\x8e\x37\x65\xc9\xbf\xb7\x3d\x4f\xd8\x9d\xd2\xf2\xa8\x24\xd3\x39\x63\x05\xf8\xbe\x2f\xcd\x01\xaa\x2d\x96\x3a\x9d\x8f\x8f\x41\xa5\x57\x1d\x8a\xbc\xf7\xb4\x91\xfe\xe3\x43\x14\xcf\xef\x5a\x79\xc4\xa1\x07\x45\xf3\xde\xf5\xe3\xbe\xcb\x8f\xe0\xc5\xb1\x2a\xe5\xb6\x44\xb9";
unsigned char externalnonce[20] = "\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13";
unsigned char rsaMod[256] = "\x81\xf5\x6c\x62\xd2\xe1\xd3\xf8\x47\x03\x00\x5f\x71\x0a\xbb\xe2\x39\xb4\x67\xc4\x30\x49\x5d\x68\x43\x89\x9b\x3c\x38\x86\x47\x9e\x63\x31\x40\x92\x72\x32\x89\x29\x72\xe9\x1d\xc5\xb2\x5e\x51\x1c\x52\x4e\x1a\x0b\x3e\xf0\x5b\x16\xd0\xf9\x5d\x67\x1d\xc4\x53\x53\x7e\x32\x35\x6c\xb1\x20\x9e\x4c\xd7\xe8\x91\xa2\x92\x8a\xd3\xa8\x3c\x37\xe9\xa9\x6c\x47\x28\xea\x22\x3c\xa6\xd5\x38\x6c\xb6\xa6\x7a\xb8\xcc\x1d\x04\x9e\xd2\x18\x0a\xe1\xa0\x46\xc4\x54\x37\xdd\x12\x95\x4f\x44\x5b\xab\xb1\x4c\x35\xfc\xdd\x59\x99\x73\x2d\xb5\x14\x52\xac\x86\x65\x76\x0e\x4a\x3b\xfb\x67\x66\x6a\x9f\x61\x25\x7a\x59\x51\x08\x32\x26\x7e\xfa\xcf\x94\xc1\x9f\x49\x05\x8c\x5c\x28\x95\x8c\x2b\xc9\xb9\xcf\x5f\x74\xd7\x67\xc3\x95\xbc\x12\x09\x2b\x4c\xf2\x1c\x7f\xfd\xc5\x60\x9a\xcb\x98\xe6\x15\xd6\x67\x13\xdf\x1d\x09\x13\x96\x20\xe1\x18\x94\xeb\x8b\x6e\xa0\x6b\x16\x80\x51\xbc\x1c\x01\x72\x1f\x77\xa5\x37\x73\x44\x51\xd2\xac\xc4\xb4\x6c\xfa\x7e\x0b\x05\xfd\x9f\x15\x08\xbc\x57\xbd\x1c\xdc\x98\x90\x8d\xba\xc9\x99\x41\x90\x88\xa7\x96\x10\x7d\x21\x6c\x22\x4d\xc9";


void setUp(void)
{
}

void tearDown(void)
{
}


void test_verify_quote(void) {
    TEST_ASSERT(verify_quote(tpm_pcr_composite, 47,
                             sig, 256, externalnonce, rsaMod) == 0);
}

void test_output_as_json(void) {
    TEST_ASSERT(output_as_json(tpm_pcr_composite, 47,
                               sig, 256, externalnonce, rsaMod) == 0);
}


    
