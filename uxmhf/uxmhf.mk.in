######
# top-level Makefile for XMHF
# author: amit vasudevan (amitvasudevan@acm.org)
######

include ./uxmhf-common.mk

######
# uXMHF build variables
######

## bootloader source path
export XMHF_BOOTLOADER_SRC := $(realpath $(XMHF_DIR)/xmhf-bootloader)

## uXMHF specific libraries
export LIBXMHFDEBUG_SRC := $(realpath $(XMHF_DIR)/libs/libxmhfdebug)
export LIBXMHFGEEC_SRC := $(realpath $(XMHF_DIR)/libs/libxmhfgeec)

## uobj source paths and count
export XMHF_SLAB_DIRS := $(shell awk -F, '{print $$1}' $(XMHF_DIR)/SLABS)
XMHF_SLAB_NAMES := $(notdir $(XMHF_SLAB_DIRS))
export XMHF_SLAB_TOTAL := $(shell wc -l < $(XMHF_DIR)/SLABS)

##uspark
#export LIBXMHFC_SRC := $(realpath uberspark/libs/libxmhfc)
##uspark
#export LIBXMHFCRYPTO_SRC := $(realpath uberspark/libs/libxmhfcrypto)
##uspark
#export LIBXMHFHW_SRC := $(realpath uberspark/libs/libxmhfhw)


######
# top-level build targets
######


.PHONY: clean 
clean:
	#$(RM) -f $(XMHF_DIR)/uxmhf/xmhf-uobjs/geec_sentinel/__geec_sentinel_autogendata_slabinfotable
	$(RM) -rf $(XMHF_OBJDIR)

# http://www.gnu.org/software/automake/manual/automake.html#Clean
distclean: clean
	$(RM) config.log config.status
	$(RM) -rf Makefile


#-----autoconf rules
Makefile: Makefile.in config.status
	./config.status $@

config.status: configure
	./config.status --recheck

configure: configure.ac
	autoconf --output=configure configure.ac

