######
# top-level Makefile for UberSpark libraries
# author: amit vasudevan (amitvasudevan@acm.org)
######

###### compute current path (where this Makefile resides)

export USPARK_LIBSDIR := $(realpath $(dir $(lastword $(MAKEFILE_LIST))))


###### include biolerplate Makefile code

include ../uberspark-common.mk

###### append additional include paths to CCERT_CFLAGS and CCERT_CASMFLAGS
USPARK_LIBSINCLUDES := -I$(USPARK_LIBSDIR)/libxmhfc/include
USPARK_LIBSINCLUDES += -I$(USPARK_LIBSDIR)/libxmhfcrypto/include
USPARK_LIBSINCLUDES += -I$(USPARK_LIBSDIR)/libxmhfgeec/include
USPARK_LIBSINCLUDES += -I$(USPARK_LIBSDIR)/libxmhfhw/include

CCERT_CFLAGS += $(USPARK_LIBSINCLUDES)
CCERT_CASMFLAGS += $(USPARK_LIBSINCLUDES)


###### targets

.PHONY: build-libs
build-libs:
	cd $(USPARK_LIBSDIR)/libxmhfc && make -f libubersparkc.mk -w build	
	cd $(USPARK_LIBSDIR)/libxmhfcrypto && make -f libubersparkcrypto.mk -w build	

.PHONY: all
all: 
	@echo $(CCERT_CFLAGS)
	@echo $(CCERT_CASMFLAGS)
	@echo $(USPARK_INSTALL_BINDIR)
	@echo $(USPARK_INSTALL_INCLUDEDIR)
	@echo $(USPARK_INSTALL_HWMDIR)
	@echo $(USPARK_INSTALL_HWMINCLUDEDIR)
	@echo $(USPARK_INSTALL_LIBSDIR)
	@echo $(USPARK_INSTALL_LIBSINCLUDESDIR)
	@echo $(USPARK_INSTALL_TOOLSDIR)


.PHONY: clean
clean:
	cd $(USPARK_LIBSDIR)/libxmhfc && make -f libubersparkc.mk -w clean	
	cd $(USPARK_LIBSDIR)/libxmhfcrypto && make -f libubersparkcrypto.mk -w clean	
	

# http://www.gnu.org/software/automake/manual/automake.html#Clean
.PHONY: distclean
distclean: clean
	$(RM) config.log config.status
	$(RM) ubersparklibs.mk

###### autoconf rules

ubersparklibs.mk: ubersparklibs.mk.in config.status
	./config.status $@

config.status: configure-ubersparklibs
	./config.status --recheck

configure-ubersparklibs: configure-ubersparklibs.ac
	autoconf --output=configure-ubersparklibs configure-ubersparklibs.ac

